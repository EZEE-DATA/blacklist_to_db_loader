# blacklist_to_db_loader
Tool to get and load blacklists of urls and IPs to db
## Описание

Утилита для загрузки заблокированных Роскомнадзором ресурсов и загрузки их в базу данных:
- black_list_loader.py - основной файл
- downloader.py - производит подключение к сервису предоставления информации и получение списка заблокированных ресурсов
- uploader.py - производит подключение к хранилищу (базе данных) сервиса Хорошие новости и загрузки в него списка заблокированных ресурсов
- settings_loader.py - набор методов для работы с файлами настроек

## Тестирование

Для запуска тестов в PyCharm необходимо создать конфигурацию запуска. Для этого:
1. В верхнем правом углу нажать кнопку с выбором конфигурации, далее "Edit Configurations..."
2. В появившемся окне нажать плюсик в верхнем левом углу и выбрать `pytest`
3. В появившемся окне заполнить поле "Target" указав путь к тесту; 
   а также в случае необходимости определить переменные среды в поле "Environment Variables"

## Запуск

Перед запуском каждого модуля необходимо проверить:
- в папке `settings` расположены файлы `*.list`(обязательно `rkn_dpi_black.list` и `rkn_ip_black.list`) содержащие ссылку на источник данных о блокировке
- в папке `tokens` расположен файл `mongodb.token` содержащий строку подключения к базе вида `mongodb://пользователь:пароль@адрес:порт`

Подразумевается, что сервисы будут запускаться планово с помощью Cron, для чего необходимо добавить в планировщик следующие записи:

```
1 * * * * bash /*путь к файлу сценария запуска*
```

В настоящий момент опрос около 1 минуты, учитывая частоту обновления данных, разумным интервалом считается опрос раз в сутки.